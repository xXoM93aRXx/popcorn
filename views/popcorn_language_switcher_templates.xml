<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Extend website.layout to add custom language switcher in top right -->
    <template id="popcorn_website_layout_language_switcher" inherit_id="website.layout">
        <xpath expr="//body" position="inside">
            <div id="popcorn-language-switcher" class="popcorn-language-switcher">
                <t t-call="popcorn.popcorn_custom_language_selector"/>
            </div>
        </xpath>
    </template>

    <!-- Custom language selector button -->
    <template id="popcorn_custom_language_selector" name="Popcorn Custom Language Selector">
        <t t-set="languages" t-value="request.website.language_ids"/>
        <t t-set="current_lang" t-value="request.env.context.get('lang', 'en_US')"/>
        <t t-if="languages and len(languages) > 1">
            <div class="popcorn-lang-selector">
            <div class="dropdown">
                <button class="btn dropdown-toggle popcorn-lang-btn" type="button" 
                        data-bs-toggle="dropdown" aria-expanded="false">
                    <span class="popcorn-current-lang">
                        <t t-foreach="languages" t-as="lang">
                            <span t-if="lang.code == current_lang">
                                <t t-if="lang.code == 'zh_CN'">中文</t>
                                <t t-elif="lang.code == 'en_US'">EN</t>
                                <t t-else="" t-esc="lang.code"/>
                            </span>
                        </t>
                    </span>
                </button>
                <ul class="dropdown-menu popcorn-lang-dropdown">
                    <t t-foreach="languages" t-as="lang">
                        <li t-if="lang.code != current_lang">
                            <a t-attf-href="#{request.httprequest.url_root}#{lang.code}#{request.httprequest.path}" 
                               class="popcorn-lang-option"
                               t-att-data-lang="lang.code">
                                <span class="popcorn-lang-name">
                                    <t t-if="lang.code == 'zh_CN'">中文</t>
                                    <t t-elif="lang.code == 'en_US'">EN</t>
                                    <t t-else="" t-esc="lang.code"/>
                                </span>
                            </a>
                        </li>
                    </t>
                </ul>
            </div>
        </div>
        </t>
    </template>
</odoo>
